{"version":3,"sources":["webpack:///game.js","webpack:///webpack/bootstrap 239d706bd6dd7f58543a","webpack:///./client/js/src/game.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","i","l","call","m","c","value","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","io","$","Vue","updateException","objectType","instanceId","changedProp","entities","xCenter","x","width","yCenter","y","height","update","ctx","clearRect","drawMap","drawEntities","coors","getRelativeCoors","left","top","drawImage","background","keys","reduce","acc","type","concat","map","id","sort","a","b","forEach","entity","updatePosition","fillStyle","fillText","strokeRect","color","fillRect","hp","maxHp","console","warn","Player","clientId","hspeed","vspeed","rightKey","upKey","leftKey","downKey","app","el","data","messages","msg","items","canvas","document","getElementById","getContext","textAlign","textboxFocused","tileSize","Image","src","spritesheet","commands","help","push","debug","variable","socket","emit","eval","on","log","setInterval","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","removed","Symbol","iterator","next","done","err","return","objects","length","instanceIds","j","changes","k","changedVal","ready","e","rect","getBoundingClientRect","clientX","clientY","preventDefault","focus","message","val","charAt","inputs","substr","split","apply","slice","blur","key","keyCode","indexOf","jQuery"],"mappings":"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","file":"game.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"/dist/\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n;(function (io, $, Vue) {\n    'use strict';\n\n    var width = 800;\n    var height = 600;\n\n    var rightKey = 68;\n    var upKey = 87;\n    var leftKey = 65;\n    var downKey = 83;\n\n    var app = new Vue({\n        el: '#game',\n        data: {\n            messages: [{\n                type: 'info',\n                msg: 'Welcome to the game!'\n            }],\n            items: []\n        }\n    });\n\n    var canvas = document.getElementById('viewport');\n    var ctx = canvas.getContext('2d');\n    ctx.textAlign = 'center';\n\n    var textboxFocused = false;\n\n    var entities = {};\n    var map = [[0, 0, 0, 0, 0], [0, 0, 0, 0, 0], [0, 0, 0, 0, 0], [0, 0, 0, 0, 0], [0, 0, 0, 0, 0]];\n    var clientId = '';\n    var tileSize = 16;\n\n    var background = new Image();\n    background.src = '../img/grass.png';\n    var spritesheet = new Image();\n    spritesheet.src = '../img/spritesheet.png';\n\n    var commands = {\n        help: function help() {\n            app.messages.push({\n                type: 'info',\n                msg: 'Commands:\\n/help - List all commands'\n            });\n        },\n        debug: function debug(variable) {\n            socket.emit('clientDebug', variable + ': ' + eval(variable));\n        }\n    };\n\n    var socket = io();\n\n    socket.on('init', function (data) {\n        console.log(data);\n        entities = data.entities;\n        Object.keys(entities).forEach(function (type) {\n            Object.keys(entities[type]).forEach(function (id) {\n                entities[type][id].type = type;\n                entities[type][id].id = id;\n            });\n        });\n        map = map;\n        clientId = data.clientId;\n        setInterval(update, 20);\n    });\n\n    socket.on('update', function (data) {\n        console.log(data);\n        var _iteratorNormalCompletion = true;\n        var _didIteratorError = false;\n        var _iteratorError = undefined;\n\n        try {\n            for (var _iterator = data.removed[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n                var removed = _step.value;\n\n                delete entities[removed.type][removed.id];\n            }\n        } catch (err) {\n            _didIteratorError = true;\n            _iteratorError = err;\n        } finally {\n            try {\n                if (!_iteratorNormalCompletion && _iterator.return) {\n                    _iterator.return();\n                }\n            } finally {\n                if (_didIteratorError) {\n                    throw _iteratorError;\n                }\n            }\n        }\n\n        var objects = Object.keys(data.entities);\n        for (var i = 0; i < objects.length; i++) {\n            var objectType = objects[i];console.log(objectType);\n            var instanceIds = Object.keys(data.entities[objectType]);\n            for (var j = 0; j < instanceIds.length; j++) {\n                var instanceId = instanceIds[j];\n                var changes = Object.keys(data.entities[objectType][instanceId]);\n                for (var k = 0; k < changes.length; k++) {\n                    var changedProp = changes[k];\n                    var changedVal = data.entities[objectType][instanceId][changedProp];\n                    if (!entities[objectType][instanceId]) {\n                        entities[objectType][instanceId] = data.entities[objectType][instanceId];\n                        entities[objectType][instanceId].type = objectType;\n                        entities[objectType][instanceId].id = instanceId;\n                    } else {\n                        entities[objectType][instanceId][changedProp] = changedVal;\n                        updateException(objectType, instanceId, changedProp);\n                    }\n                }\n            }\n        }\n        //app.$set(app, 'items', data.inventory.items);\n    });\n\n    socket.on('chatMsg', function (data) {\n        app.messages = app.messages.concat([data]);\n    });\n\n    $(document).ready(function () {\n\n        $('#viewport').on('mousedown', function (e) {\n            var rect = canvas.getBoundingClientRect();\n            socket.emit('click', {\n                x: e.clientX - rect.left - width / 2 + entities.Player[clientId].x,\n                y: e.clientY - rect.top - height / 2 + entities.Player[clientId].y\n            });\n        });\n\n        $('#game-cont').on('contextmenu', function (e) {\n            e.preventDefault();\n        });\n\n        $('#chat-input, .login-input').on(\"focus\", function () {\n            textboxFocused = true;\n        }).on(\"blur\", function () {\n            textboxFocused = false;\n        });\n\n        $('#chat-cont').on('click', function (e) {\n            $('#chat-input').focus();\n        });\n\n        $('#chat-form').on('submit', function (e) {\n            e.preventDefault();\n            var message = $('#chat-input').val();\n            if (message.charAt(0) === '/') {\n                var inputs = message.substr(1).split(' ');\n                if (commands[inputs[0]]) {\n                    commands[inputs[0]].apply(null, inputs.slice(1));\n                } else {\n                    socket.emit('chatMsg', message.substr(0, 140));\n                }\n            } else {\n                socket.emit('chatMsg', message.substr(0, 140));\n            }\n            $('#chat-input').blur();\n            $('#chat-input').val('');\n            textboxFocused = false;\n        });\n    }).on('keydown', function (e) {\n        if (!textboxFocused) {\n            socket.emit('keyDown', {\n                key: e.keyCode\n            });\n            if ([rightKey, upKey, leftKey, downKey].indexOf(e.keyCode) !== -1) {\n                e.preventDefault();\n            }\n            if (e.keyCode === 84) {\n                $('#chat-input').focus();\n                e.preventDefault();\n            }\n            if (e.keyCode === 191) {\n                $('#chat-input').focus();\n            }\n        }\n    }).on('keyup', function (e) {\n        socket.emit('keyUp', {\n            key: e.keyCode\n        });\n    });\n\n    function updateException(objectType, instanceId, changedProp) {\n        var object = entities[objectType][instanceId];\n        if (objectType === 'Player') {\n            if (changedProp === 'x') {\n                object.xCenter = object.x + object.width / 2;\n            } else if (changedProp === 'y') {\n                object.yCenter = object.y + object.height / 2;\n            }\n        }\n    }\n\n    function update() {\n        ctx.clearRect(0, 0, width, height);\n        drawMap();\n        drawEntities();\n    }\n\n    function drawMap() {\n        var coors = getRelativeCoors([0, 0]);\n        var left = coors[0];\n        var top = coors[1];\n        for (var x = 0; x < width; x += 480) {\n            for (var y = 0; y < height; y += 480) {\n                ctx.drawImage(background, left + x, top + y, 480, 480);\n            }\n        }\n        /*map.forEach((row, y) => {\n            row.forEach((tile, x) => {\n                ctx.drawImage(spritesheet, (tile * (tileSize + 1)) % 968, tile * (tileSize + 1), tileSize, tileSize, left + x * tileSize, top + y * tileSize, tileSize, tileSize);\n            });\n        });*/\n    }\n\n    function drawEntities() {\n        Object.keys(entities).reduce(function (acc, type) {\n            return acc.concat(Object.keys(entities[type]).map(function (id) {\n                return entities[type][id];\n            }));\n        }, []).sort(function (a, b) {\n            return a.y + a.height > b.y + b.height;\n        }).forEach(function (entity) {\n            var coors = getRelativeCoors([entity.x, entity.y]);\n            var x = coors[0];\n            var y = coors[1];\n            switch (entity.type) {\n                case 'Player':\n                    updatePosition(entity);\n                    ctx.fillStyle = 'black';\n                    ctx.fillText(entity.name, x + 8, y - 12);\n                    ctx.strokeRect(x, y, 16, 16);\n                    ctx.fillStyle = entity.color;\n                    ctx.fillRect(x, y, 16, 16);\n                    //if (id === clientId){\n                    ctx.fillStyle = 'black';\n                    ctx.fillRect(x - 4, y - 8, 24, 4);\n                    ctx.fillStyle = 'red';\n                    ctx.fillRect(x - 4, y - 8, 24 * entity.hp / entity.maxHp, 4);\n                    //}\n                    break;\n                case 'Bullet':\n                    updatePosition(entity);\n                    ctx.strokeRect(x, y, 16, 16);\n                    ctx.fillStyle = 'black';\n                    ctx.fillRect(x, y, 16, 16);\n                    break;\n                case 'Enemy':\n                    updatePosition(entity);\n                    ctx.strokeRect(x, y, 16, 16);\n                    ctx.fillStyle = '#922';\n                    ctx.fillRect(x, y, 16, 16);\n                    ctx.fillStyle = 'black';\n                    ctx.fillRect(x - 4, y - 8, 24, 4);\n                    ctx.fillStyle = 'red';\n                    ctx.fillRect(x - 4, y - 8, 24 * entity.hp / entity.maxHp, 4);\n                    ctx.fillStyle = 'black';\n                    ctx.fillText(entity.name, x + 8, y - 12);\n                    break;\n                case 'ItemDrop':\n                    updatePosition(entity);\n                    ctx.strokeRect(x, y, 16, 16);\n                    ctx.fillStyle = 'pink';\n                    ctx.fillRect(x, y, 16, 16);\n                    break;\n                default:\n                    console.warn('unrecognized type ' + entity.type);\n                    break;\n            }\n        });\n    }\n\n    function getRelativeCoors(coors) {\n        return [coors[0] - entities.Player[clientId].x + width / 2, coors[1] - entities.Player[clientId].y + height / 2];\n    }\n\n    function updatePosition(entity) {\n        entity.x += entity.hspeed / 2;\n        entity.y += entity.vspeed / 2;\n    }\n})(io, jQuery, Vue);\n\n/***/ })\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// game.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/dist/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 239d706bd6dd7f58543a",";(function(io, $, Vue){\n    'use strict';\n    \n    var width = 800;\n    var height = 600;\n    \n    var rightKey = 68;\n    var upKey = 87;\n    var leftKey = 65;\n    var downKey = 83;\n    \n    var app = new Vue({\n        el: '#game',\n        data: {\n            messages: [{\n                type: 'info',\n                msg: 'Welcome to the game!'\n            }],\n            items: []\n        }\n    });\n    \n    var canvas = document.getElementById('viewport');\n    var ctx = canvas.getContext('2d');\n    ctx.textAlign = 'center';\n    \n    var textboxFocused = false;\n    \n    var entities = {};\n    var map = [\n        [0, 0, 0, 0, 0],\n        [0, 0, 0, 0, 0],\n        [0, 0, 0, 0, 0],\n        [0, 0, 0, 0, 0],\n        [0, 0, 0, 0, 0],\n    ];\n    var clientId = '';\n    var tileSize = 16;\n    \n    var background = new Image();\n    background.src = '../img/grass.png';\n    var spritesheet = new Image();\n    spritesheet.src = '../img/spritesheet.png';\n    \n    const commands = {\n        help: function(){\n            app.messages.push({\n                type: 'info',\n                msg: 'Commands:\\n/help - List all commands'\n            });\n        },\n        debug: function(variable){\n            socket.emit('clientDebug', variable + ': ' + eval(variable));\n        }\n    };\n    \n    var socket = io();\n    \n    socket.on('init', function(data){console.log(data);\n        entities = data.entities;\n        Object.keys(entities).forEach(type => {\n           Object.keys(entities[type]).forEach(id => {\n               entities[type][id].type = type;\n               entities[type][id].id = id;\n           });\n        });\n        map = map;\n        clientId = data.clientId;\n        setInterval(update, 20);\n    });\n    \n    socket.on('update', function(data){console.log(data);\n        for (var removed of data.removed){\n            delete entities[removed.type][removed.id];\n        }\n        var objects = Object.keys(data.entities);\n        for (var i = 0; i < objects.length; i ++){\n            var objectType = objects[i];console.log(objectType);\n            var instanceIds = Object.keys(data.entities[objectType]);\n            for (var j = 0; j < instanceIds.length; j ++){\n                var instanceId = instanceIds[j];\n                var changes = Object.keys(data.entities[objectType][instanceId]);\n                for (var k = 0; k < changes.length; k ++){\n                    var changedProp = changes[k];\n                    var changedVal = data.entities[objectType][instanceId][changedProp];\n                    if (!entities[objectType][instanceId]){\n                        entities[objectType][instanceId] = data.entities[objectType][instanceId];\n                        entities[objectType][instanceId].type = objectType;\n                        entities[objectType][instanceId].id = instanceId;\n                    } else {\n                        entities[objectType][instanceId][changedProp] = changedVal;\n                        updateException(objectType, instanceId, changedProp);\n                    }\n                }\n            }\n        }\n        //app.$set(app, 'items', data.inventory.items);\n    });\n    \n    socket.on('chatMsg', data => {\n        app.messages = app.messages.concat([data]);\n    });\n    \n    $(document)\n        .ready(function(){\n            \n            $('#viewport').on('mousedown', function(e){\n                var rect = canvas.getBoundingClientRect();\n                socket.emit('click', {\n                    x: e.clientX - rect.left - width / 2 + entities.Player[clientId].x,\n                    y: e.clientY - rect.top - height / 2 + entities.Player[clientId].y\n                });\n            });\n            \n            $('#game-cont').on('contextmenu', function(e){\n                e.preventDefault();\n            });\n            \n            $('#chat-input, .login-input')\n                .on(\"focus\", function(){\n                    textboxFocused = true;\n                })\n                .on(\"blur\", function(){\n                    textboxFocused = false;\n                });\n            \n            $('#chat-cont').on('click', function(e){\n                $('#chat-input').focus();\n            });\n            \n            $('#chat-form').on('submit', function(e){\n                e.preventDefault();\n                var message = $('#chat-input').val();\n                if (message.charAt(0) === '/'){\n                    var inputs = message.substr(1).split(' ');\n                    if (commands[inputs[0]]){\n                        commands[inputs[0]].apply(null, inputs.slice(1));\n                    } else {\n                        socket.emit('chatMsg', message.substr(0, 140));\n                    }\n                } else {\n                    socket.emit('chatMsg', message.substr(0, 140));\n                }\n                $('#chat-input').blur();\n                $('#chat-input').val('');\n                textboxFocused = false;\n                \n            });\n            \n        })\n        .on('keydown', function(e){\n            if (!textboxFocused){\n                socket.emit('keyDown', {\n                    key: e.keyCode\n                });\n                if ([rightKey, upKey, leftKey, downKey].indexOf(e.keyCode) !== -1){\n                    e.preventDefault();\n                }\n                if (e.keyCode === 84){\n                    $('#chat-input').focus();\n                    e.preventDefault();\n                }\n                if (e.keyCode === 191){\n                    $('#chat-input').focus();\n                }\n            }\n        })\n        .on('keyup', function(e){\n            socket.emit('keyUp', {\n                key: e.keyCode\n            });\n        });\n    \n    function updateException(objectType, instanceId, changedProp){\n        var object = entities[objectType][instanceId];\n        if (objectType === 'Player'){\n            if (changedProp === 'x'){\n                object.xCenter = object.x + object.width / 2;\n            } else if (changedProp === 'y'){\n                object.yCenter = object.y + object.height / 2;\n            }\n        }\n    }\n    \n    function update(){\n        ctx.clearRect(0, 0, width, height);\n        drawMap();\n        drawEntities();\n    }\n    \n    function drawMap(){\n        var coors = getRelativeCoors([0, 0]);\n        var left = coors[0];\n        var top = coors[1];\n        for (var x = 0; x < width; x += 480){\n            for (var y = 0; y < height; y += 480){\n                ctx.drawImage(background, left + x, top + y, 480, 480);\n            }\n        }\n        /*map.forEach((row, y) => {\n            row.forEach((tile, x) => {\n                ctx.drawImage(spritesheet, (tile * (tileSize + 1)) % 968, tile * (tileSize + 1), tileSize, tileSize, left + x * tileSize, top + y * tileSize, tileSize, tileSize);\n            });\n        });*/\n    }\n    \n    function drawEntities(){\n        Object.keys(entities)  \n            .reduce((acc, type) => acc.concat(Object.keys(entities[type]).map(id => entities[type][id])), [])\n            .sort((a, b) => a.y + a.height > b.y + b.height)\n            .forEach(entity => {\n                let coors = getRelativeCoors([entity.x, entity.y]);\n                let x = coors[0];\n                let y = coors[1];\n                switch (entity.type){\n                    case 'Player':\n                        updatePosition(entity);\n                        ctx.fillStyle = 'black';\n                        ctx.fillText(entity.name, x + 8, y - 12);\n                        ctx.strokeRect(x, y, 16, 16);\n                        ctx.fillStyle = entity.color;\n                        ctx.fillRect(x, y, 16, 16);\n                        //if (id === clientId){\n                            ctx.fillStyle = 'black';\n                            ctx.fillRect(x - 4, y - 8, 24, 4);\n                            ctx.fillStyle = 'red';\n                            ctx.fillRect(x - 4, y - 8, 24 * entity.hp / entity.maxHp, 4);\n                        //}\n                        break;\n                    case 'Bullet':\n                        updatePosition(entity);\n                        ctx.strokeRect(x, y, 16, 16);\n                        ctx.fillStyle = 'black';\n                        ctx.fillRect(x, y, 16, 16);\n                        break;\n                    case 'Enemy':\n                        updatePosition(entity);\n                        ctx.strokeRect(x, y, 16, 16);\n                        ctx.fillStyle = '#922';\n                        ctx.fillRect(x, y, 16, 16);\n                        ctx.fillStyle = 'black';\n                        ctx.fillRect(x - 4, y - 8, 24, 4);\n                        ctx.fillStyle = 'red';\n                        ctx.fillRect(x - 4, y - 8, 24 * entity.hp / entity.maxHp, 4);\n                        ctx.fillStyle = 'black';\n                        ctx.fillText(entity.name, x + 8, y - 12);\n                        break;\n                    case 'ItemDrop':\n                        updatePosition(entity);\n                        ctx.strokeRect(x, y, 16, 16);\n                        ctx.fillStyle = 'pink';\n                        ctx.fillRect(x, y, 16, 16);\n                        break;\n                    default:\n                        console.warn('unrecognized type ' + entity.type);\n                        break;\n                }\n            });\n    }\n    \n    function getRelativeCoors(coors){\n        return [coors[0] - entities.Player[clientId].x + width / 2, coors[1] - entities.Player[clientId].y + height / 2];\n    }\n    \n    function updatePosition(entity){\n        entity.x += entity.hspeed / 2;\n        entity.y += entity.vspeed / 2;\n    }\n    \n})(io, jQuery, Vue);\n\n\n\n// WEBPACK FOOTER //\n// ./client/js/src/game.js"],"sourceRoot":""}